(function(){angular.module("BaitsaagchApp",["ngRoute","ngSanitize"]);function t(t,e){t.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/help",{templateUrl:"help/help.view.html",controller:"helpCtrl",controllerAs:"vm"}).when("/config",{templateUrl:"help/config.view.html",controllerAs:"vm"}).when("/transport/:bus_id",{templateUrl:"/transport/transport.view.html",controller:"transportCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});e.html5Mode(true)}angular.module("BaitsaagchApp").config(["$routeProvider","$locationProvider",t])})();(function(){angular.module("BaitsaagchApp").controller("homeCtrl",t).directive("test",e);t.$inject=["$scope","myGlobalVars","baitsaagchData","$compile","$q"];function t(t,e,a,r,o){var i=this;a.getLocs().then(function t(e){i.locs=e.data},function t(e){});i.getHoPa=function(o){if(o!=null){e.name=o.name;e.lat=o.lat;e.lng=o.lng;i.message="Checking transports information";$("#came").empty();$("#come").empty();a.getTransportsList(e.name).then(function a(o){i.message=o.data.length>0?"":"Энэ байршилд ирэх автобус олдсонгүй";i.transports=o.data;var s=false;var l=false;for(var c=0;c<i.transports.length;c++){var p=n(i.transports[c].directions[0].lat,i.transports[c].directions[0].lng,i.transports[c].directions[i.transports[c].directions.length-1].lat,i.transports[c].directions[0].lng);var u=n(i.transports[c].directions[0].lat,i.transports[c].directions[0].lng,i.transports[c].directions[0].lat,i.transports[c].directions[i.transports[c].directions.length-1].lng);if(u<p){if(i.transports[c].directions[0].lat-i.transports[c].directions[i.transports[c].directions.length-1].lat>0)i.up_down="vertdown";else i.up_down="vertup"}else{if(i.transports[c].directions[0].lng-i.transports[c].directions[i.transports[c].directions.length-1].lng>0)i.up_down="horileft";else i.up_down="horiright"}var d=r('<test info="vm.transports['+c+']"></test>')(t);var m={lat:46.353,lng:108.403};if(i.up_down=="vertup"){if(m.lat-e.lat>0){if(l==false){l=true;$("#came").append("<h5>Өнгөрсөн</h5>")}$("#came").append(d)}else{if(s==false){s=true;$("#come").append("<h5>Ирэх</h5>")}$("#come").append(d)}}else if(i.up_down=="vertdown"){if(m.lat-e.lat<0){if(l==false){l=true;$("#came").append("<h5>Өнгөрсөн</h5>")}$("#came").append(d)}else{if(s==false){s=true;$("#come").append("<h5>Ирэх</h5>")}$("#come").append(d)}}else if(i.up_down=="horileft"){if(m.lng-e.lng>0){if(l==false){l=true;$("#came").append("<h5>Өнгөрсөн</h5>")}$("#came").append(d)}else{if(s==false){s=true;$("#come").append("<h5>Ирэх</h5>")}$("#come").append(d)}}else if(i.up_down=="horiright"){if(m.lng-e.lng<0){if(l==false){l=true;$("#came").append("<h5>Өнгөрсөн</h5>")}$("#came").append(d)}else{if(s==false){s=true;$("#come").append("<h5>Ирэх</h5>")}$("#come").append(d)}}}},function t(e){i.message="Sorry, something's gone wrosng"})}};i.sidebar={hello:"Энэ өдрийн мэнд!",content:"Энэхүү апп нь авто тээврийн байцаагчийн ажлыг хөнгөвчилхөд зориулсан апп юм. Нэмэлт боломжуудыг оруулахыг хүсвэл BaitsaagchApp @yahoo.com хаягаар холбогдоно уу."}}function e(){return{restrict:"E",scope:{info:"="},template:'<a href="transport/{{ id }}"><div class="col-md-2 col-xs-12 list-group-item list-group-item-action" style="float: left; margin-left: 10px; margin-top: 10px;">'+'<h5 style="position: absolute; right: 10px; margin-top: -35px;">{{ time }}</h5>'+'<h3 style="margin-top: 0px;">{{ busNum }}</h3>'+"<span>{{ fromDir }}-{{ toDir}}</span>"+"</div></a>",controller:["$scope","baitsaagchData","myGlobalVars",function(t,e,a){t.id=t.info._id;e.getLocation(t.info.busNumber).then(function e(r){var o=r.data;var i=n(o.lat,o.lng,a.lat,a.lng)/80;t.time=i.toFixed(1)+"цаг"},function t(e){});t.busNum=t.info.busNumber;t.fromDir=t.info.directions[0].name;t.toDir=t.info.directions[t.info.directions.length-1].name}]}}function n(t,e,n,r){var o=6371;var i=a(n-t);var s=a(r-e);var l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(a(t))*Math.cos(a(n))*Math.sin(s/2)*Math.sin(s/2);var c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));var p=o*c;return p}function a(t){return t*(Math.PI/180)}})();(function(){angular.module("BaitsaagchApp").controller("transportCtrl",t);t.$inject=["$routeParams","baitsaagchData","$sce","$window"];function t(t,e,n,a){var r=this;var o=new google.maps.DirectionsService;var i=new google.maps.DirectionsRenderer;e.getTransport(t.bus_id).then(function t(n){r.transport=n.data;r.content={speed:(r.transport.distance/(Math.abs(Date.now()-Date.parse(r.transport.fromDate))/(1e3*60*60)).toFixed(1)).toFixed(2)+"км/цаг"};r.fromDir=r.transport.directions[0].name;r.toDir=r.transport.directions[r.transport.directions.length-1].name;r.calculateAndDisplayRoute=function(){e.getLocation().then(function t(e){var n=e.data;console.log(r.transport);r.busMarker=new google.maps.Marker({position:n,map:r.map,title:"Автобус",animation:google.maps.Animation.BOUNCE,label:"Bus"})},function t(e){});var t={origin:r.transport.directions[0].lat+", "+r.transport.directions[0].lng,destination:r.transport.directions[r.transport.directions.length-1].lat+", "+r.transport.directions[r.transport.directions.length-1].lng,travelMode:"DRIVING",waypoints:[]};for(var n=1;n<r.transport.directions.length-1;n++){t.waypoints.push({location:r.transport.directions[n].lat+", "+r.transport.directions[n].lng,stopover:true})}o.route(t,function(t,e){if(e==="OK"){i.setDirections(t)}else{window.alert("Directions request failed due to "+e)}})};r.calculateAndDisplayRoute();a.initMap=function(){r.map=new google.maps.Map(document.getElementById("map"),{zoom:6,center:{lat:46.3529,lng:108.4032}});i.setMap(r.map);var t=r.busMarker};a.initMap()},function t(e){console.log("ene duudagdana gej baihguiee")});r.change=function(){if(r.restTime>(Math.abs(Date.now()-Date.parse(r.transport.fromDate))/(1e3*60*60)).toFixed(1)){r.content={speed:"Амарсан цаг явсан цагаас хэтэрч болохгүй"}}else if(r.restTime==null){r.content={speed:(r.transport.distance/(Math.abs(Date.now()-Date.parse(r.transport.fromDate))/(1e3*60*60)).toFixed(1)).toFixed(1)+"км/цаг"}}else{r.content={speed:(r.transport.distance/((Math.abs(Date.now()-Date.parse(r.transport.fromDate))/(1e3*60*60)).toFixed(1)-r.restTime)).toFixed(1)+"км/цаг"}}}}})();(function(){angular.module("BaitsaagchApp").controller("helpCtrl",t);function t(){var t=this;t.main={content:"Нүүр хуудсанд ирж бүртгүүлэх ёстой автобуснуудын жагсаалт байгаа\nменюнд байрлах байршлуудаас өөрийн байршлийг сонгон харах боломжтой\n"}}})();(function(){angular.module("BaitsaagchApp").service("baitsaagchData",t);t.$inject=["$q","$http"];function t(t,e){var n=function(){var n=t.defer();e.get("config.json").then(function t(e){n.resolve(e)});return n.promise};var a=function(t){return n().then(function(n){return e.get(n.data.getTransportsList+t)})};var r=function(t){return n().then(function(n){return e.get(n.data.getTransport+t)})};var o=function(){return n().then(function(t){return e.get(t.data.getLocs)})};var i=function(t){return n().then(function(n){return e.get(n.data.getLocation+t)})};return{getTransportsList:a,getTransport:r,getLocs:o,getLocation:i}}})();(function(){angular.module("BaitsaagchApp").service("myGlobalVars",t);function t(){return{name:"Улаанбаатар",lat:47.8864,lng:106.9057}}})();(function(){angular.module("BaitsaagchApp").directive("footerGeneric",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("BaitsaagchApp").directive("navigation",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();